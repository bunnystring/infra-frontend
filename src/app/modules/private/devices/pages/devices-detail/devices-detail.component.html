<div *ngIf="loading$ | async" class="toast toast-top toast-center z-50">
  <div class="alert alert-info gap-2">
    <span class="loading loading-spinner loading-sm"></span>
    <span>Actualizando datos...</span>
  </div>
</div>

<button class="btn btn-outline btn-primary mb-6 flex items-center gap-2" (click)="goBack()">
  <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
  </svg>
  Volver a dispositivos
</button>

<!-- ERROR -->
<div *ngIf="error" class="alert alert-error mt-8 mx-auto w-fit text-lg shadow-lg">
  <svg class="h-6 w-6 text-error" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  {{ error }}
</div>

<!-- DETALLE DEL DISPOSITIVO -->
<div *ngIf="device$ | async as device"
  class="mx-auto max-w-4xl bg-white border border-blue-200 rounded-2xl shadow-xl p-8 mt-10">
  <div class="flex items-center gap-4 mb-5">
    <svg class="h-12 w-12 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
    </svg>
    <div>
      <h2 class="text-3xl font-extrabold text-blue-700">{{ device.name }}</h2>
      <div class="flex items-center gap-2 mt-1 text-base font-medium">
        <span class="badge badge-primary">{{ device.status }}</span>
        <span class="badge badge-info">{{ device.brand }}</span>
        <span class="badge badge-outline badge-lg text-blue-700 bg-blue-50">{{ device.barcode }}</span>
      </div>
    </div>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4 text-blue-900">
    <div>
      <span class="font-semibold mb-1 block">Marca:</span>
      <span>{{ device.brand }}</span>
    </div>
    <div>
      <span class="font-semibold mb-1 block">Código de barras:</span>
      <span>{{ device.barcode }}</span>
    </div>
    <div>
      <span class="font-semibold mb-1 block">Estado:</span>
      <span class="badge badge-warning">{{ device.status }}</span>
    </div>
  </div>
</div>

<!-- HISTORIAL DE ASIGNACIONES -->
<div class="max-w-4xl mx-auto bg-white border border-blue-100 rounded-2xl shadow-lg p-6 mt-10 mb-16">
  <div class="flex justify-between items-center mb-4">
      <h3 class="text-2xl font-semibold mb-4 flex items-center gap-3 text-blue-600">
    <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
    </svg>
    Historial de asignaciones
  </h3>
  <button class="btn btn-ghost gap-2" (click)="refreshData()" [disabled]="loading$ | async">
    <span *ngIf="loading$ | async" class="loading loading-spinner loading-xs"></span>
    <svg *ngIf="!(loading$ | async)" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
    </svg>
    <span class="hidden sm:inline">
      {{ (loading$ | async) ? 'Actualizando...' : 'Actualizar' }}
    </span>
  </button>
  </div>
  <ng-container *ngIf="deviceAssignments$ | async as deviceAssignments">
    <table *ngIf="deviceAssignments.length > 0" class="table w-full rounded-xl shadow-md overflow-hidden text-blue-900">
      <thead>
        <tr>
          <th class="bg-blue-50 text-blue-800">Descripción de la órden</th>
          <th class="bg-blue-50 text-blue-800">Estado</th>
          <th class="bg-blue-50 text-blue-800">Asignado</th>
          <th class="bg-blue-50 text-blue-800">Liberado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of deviceAssignments" class="hover:bg-blue-100">
          <td>
            <ng-container *ngIf="a.orderFound; else shortId">
              <button class="link link-primary font-semibold" (click)="goDetailOrder(a.orderId)">
                {{ a.orderName }}
              </button>
            </ng-container>
            <ng-template #shortId>
              <span class="badge badge-ghost">{{ a.orderName }}</span>
            </ng-template>
          </td>
          <td>
            <span class="badge badge-info">{{ a.deviceStatus }}</span>
          </td>
          <td>
            <span class="text-green-700">{{ a.assignedAt | date }}</span>
          </td>
          <td>
            <span class="text-amber-700" *ngIf="a.releasedAt">{{ a.releasedAt | date }}</span>
            <span *ngIf="!a.releasedAt" class="text-gray-400">Sin liberar</span>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="deviceAssignments.length === 0" class="py-12 text-center opacity-80">
      <svg class="mx-auto h-12 w-12 text-blue-300 mb-2" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div class="text-xl font-semibold text-blue-900">Sin historial de asignaciones</div>
    </div>
  </ng-container>
</div>
